[{"title":"置顶公告","url":"/Blog/posts/25ad5f96/","content":"关于新版本网站的公告（其实是笨蛋亓翎的谢罪函）大家好，这里跟大家说明一下网站的新版本情况。\n因为之前亓翎在整理&#x2F;维护网站时不小心把网站的原始结构数据整个误删了，导致旧版本的数据出现了比较大的缺口。现在手头能留下来的内容，主要是一些零散的存档（并不是完整站点），还有就是Hexo的生成文件，很多页面之间的关联、分类、时间线、链接结构之类的信息都丢失了。也正因为这样，旧版想要“一键恢复”基本不现实，要恢复的话只能靠后续一点点整理、核对、重建，工作量和难度都会比较高。\n考虑到网站不能一直停着不更新，也不想让大家一直看到缺内容、打不开的页面，所以我决定把网站直接重构，先把新版本的框架搭起来。新版本会以更清晰、也更好维护的方式重新整理结构，这样后面更新内容、修复问题、补充功能都会更顺手，也能减少类似情况再次发生的概率。\n关于大家比较关心的“以前的文章还会不会回来”：会的，但可能需要时间。我会根据现有存档的情况，优先把能确定内容完整、整理成本相对低的文章先恢复出来；剩下比较零碎、需要补齐信息或重新排版的内容，会在后续慢慢补。恢复进度可能不会特别快，但会持续推进。也就是说，旧内容不是“没了”，而是需要一个逐步找回、逐步整理的过程。\n这次的情况给大家带来不便真的很抱歉，也谢谢大家一直以来的理解和支持。如果你发现新版本里有链接失效、排版问题，或者你记得某篇旧文但现在找不到，也欢迎提醒我（有线索会更好，比如标题、关键词、发布时间大概范围等），我会尽量安排处理。\n总之：新版本先保证稳定可用，旧内容会陆续回归。谢谢大家，敬请期待后续更新。（我这次也是对内容做了原始数据的备份，长教训了）\n","categories":["Announcement"],"tags":["Announcement"]},{"title":"Certificate-Management","url":"/Blog/posts/6c20921f/","content":"\n  \n  荣誉证书管理系统\n  \n    一款功能完整、界面精美的荣誉证书管理桌面应用。\n    支持荣誉证书的全生命周期管理：从录入、统计分析、成员管理到附件管理，一应俱全。\n    当前版本： v1.4.0（2025-12-18）\n  \n\n\n\n\n\n  📖 目录导航 (点击展开)\n\n\n✨ 核心特性\n🎯 功能详情\n\n\n🛠️ 技术栈\n📸 界面预览\n🚀 快速开始\n📥 安装步骤\n🛠️ 常用命令\n🧾 AI 证书识别\n⚙️ 配置与模型\n🧾 使用流程\n\n\n📥 导入 &#x2F; 导出（CSV&#x2F;XLSX）\n🤖 MCP 接入（本地）\n🔌 连接方式\n🛡️ 权限与安全\n🛠️ 能力概览\n⚙️ 常用环境变量\n\n\n\n\n📂 文件目录说明\n🏗️ 项目架构\n💾 数据模型\n🏆 荣誉记录 (Awards)\n🧩 荣誉成员快照 (AwardMembers)\n👤 参与成员 (TeamMembers)\n🤖 AI 提供商 (AIProviders)\n🏷️ 自定义开关 (CustomFlags&#x2F;AwardFlagValues)\n🎓 专业与学校 (Majors&#x2F;Schools)\n\n\n🔐 数据安全与备份\n🎨 主题系统\n🛠️ 开发指南\n🧰 故障排查\n📝 更新日志\nv1.4.0 (2025-12-18)\nv1.3.1 (2025-12-17)\nv1.3.0 (2025-12-16)\nv1.2.0 (2025-12-14)\nv1.1.0 (2025-12-09 ~ 2025-12-10)\nv1.0.1 (2025-12-04 ~ 2025-12-07)\nv1.0.0 (2025-12-02 ~ 2025-12-03)\n\n\n📈 Star History\n🤝 如何贡献\n📄 许可证\n\n\n\n\n✨ 核心特性\n  \n    \n      \n        ⚡ 极速检索\n        500ms 防抖全文检索FTS5 引擎加持\n      \n      \n        📊 数据可视化\n        8 张动态指标卡图表实时联动\n      \n      \n        🧭 丝滑体验\n        页面异步懒加载启动速度飞快\n      \n      \n        🛡️ 数据安全\n        本地 SQLite 存储自动定时备份\n      \n    \n    \n      \n        🧠 智能补全\n        专业/学院自动匹配支持拼音/代码搜索\n      \n      \n        🗑️ 后悔药\n        回收站机制双重删除确认\n      \n      \n        🎨 炫彩主题\n        深色/浅色模式一键实时切换\n      \n      \n        🛠️ 运维工具\n        一键清理日志/备份数据库维护工具\n      \n    \n  \n\n\n🎯 功能详情\n首页: 快速导航与最近动态，一键直达常用功能。\n仪表盘: 8 个梯度指标卡 + 饼&#x2F;柱图可视化 + 最近荣誉速览。\n总览: FTS5 全文搜索（比赛名&#x2F;证书号&#x2F;成员）+ 筛选排序分页，支持编辑与批量操作。\n录入: 卡片式表单，多成员动态管理；集成专业&#x2F;学校智能搜索（中文&#x2F;拼音&#x2F;代码）；支持一键 AI 识别证书（图片&#x2F;PDF）。\n成员管理: 成员库维护与详情，10 字段监控与快速修改。\n回收站: 已删除记录可恢复&#x2F;彻底删除，双重确认。\n系统设置: 主题&#x2F;备份&#x2F;日志&#x2F;索引维护与清理工具，自定义开关管理，导入模板下载；AI 与 MCP 配置入口。\nMCP 接入: 内置本地 MCP（stdio&#x2F;SSE）与可选 Web 控制台，默认只读，支持 PII 脱敏与写入开关。\n\n\n🛠️ 技术栈\n\n\n\n\n核心框架\n数据存储\n工具链\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAI 证书识别：OpenAI 兼容 API（Chat Completions&#x2F;Responses）+ PyMuPDF（PDF 渲染）+ Pydantic（结构化解析）\nMCP：mcp（FastMCP），支持 stdio&#x2F;SSE；可选 gradio Web 控制台\n日志：loguru（应用日志与 MCP 进程日志输出到 logs/）\n类型检查：pyright（标准模式）+ ruff（风格&#x2F;未使用项）\n\n\n📸 界面预览\n💡 提示: 点击图片可查看大图\n\n\n  \n    \n      \n        \n        🏠 首页快速导航与最近动态\n      \n      \n        \n        📊 仪表盘指标卡 + 统计图表\n      \n    \n    \n      \n        \n        👀 总览页FTS5 搜索 + 筛选排序\n      \n      \n        \n        📝 录入页成员卡片式表单 + AI 识别\n      \n    \n    \n      \n        \n        👥 成员管理10 字段监控与详情\n      \n      \n        \n        ⚙️ 设置页主题/备份/清理/日志\n      \n    \n  \n\n\n\n🚀 快速开始📥 安装步骤\n克隆仓库\ngit clone https://github.com/RE-TikaRa/Certificate-Management.gitcd Certificate-Management\n\n安装依赖 (推荐使用 uv)\n# 安装 uv (如果尚未安装)# pip install uv# 同步环境uv sync\n\n启动应用\n# Windows 快捷启动./main.bat# 或使用 uv 启动uv run python -m src.main\n\n🛠️ 常用命令\n\n\n操作\n命令\n说明\n\n\n\n运行\nuv run python -m src.main\n启动主程序\n\n\n调试\nuv run python -m src.main --debug\n开启调试日志\n\n\n检查\nuv run ruff check .\n代码 Lint 检查\n\n\n格式化\nuv run ruff format .\n代码自动格式化\n\n\n类型检查\nuv run python -m pyright\nPyright 标准模式\n\n\n语法检查\nuv run python -m py_compile src/\n基础语法编译检查\n\n\nMCP 服务\nuv run certificate-mcp\n启动 MCP（默认 stdio，只读）\n\n\nMCP SSE\nCERT_MCP_TRANSPORT=sse uv run certificate-mcp\n启动 SSE（默认 http://127.0.0.1:8000/sse；推荐用设置页随软件启动）\n\n\nMCP Web\nuv run certificate-mcp-web\n启动本地 Web 控制台（需安装可选依赖；默认 http://127.0.0.1:7860）\n\n\n\n🧾 AI 证书识别AI 证书识别用于“荣誉录入”页面的一键识别：从证书图片&#x2F;PDF 自动抽取 比赛名称、获奖日期、赛事级别、奖项等级、证书编号、成员姓名，并在预览对话框中确认后再写入表单。\n⚙️ 配置与模型\n打开 系统设置 → AI 证书识别，勾选“启用 AI 证书识别”\n配置一个提供商（Provider）\nAPI 地址：OpenAI 兼容地址（如 https://api.openai.com 或你的兼容中转）\nAPI Key：支持多 Key，程序会按请求轮换（见下文）\n模型：可手动填写模型 ID；若你的服务支持 /v1/models，可在设置页刷新&#x2F;选择\nPDF 页数：1~10（PDF 会渲染前 N 页作为图片参与识别）\n\n\n点击“测试联通”验证配置（会发起最小请求）\n\n说明（按当前实现）：\n\n支持文件：.pdf .png .jpg .jpeg .webp\nKey 轮换：每次调用（识别证书、刷新模型、测试联通）都会轮到下一个 Key；当前不会在失败时自动切 Key 重试\nOpenAI 官方 api.openai.com：会走 responses 接口；PDF 会以文件方式上传，图片会以单张图片方式上传\n兼容服务：走 /v1/chat/completions；PDF 会按“PDF 页数”渲染多页图片后发送\n\n🧾 使用流程\n在 荣誉录入 页点击顶部“AI 识别证书”\n选择证书文件后，程序会自动将其加入附件并开始识别\n在“AI 识别预览”中确认&#x2F;修改结果后应用到表单\n\n\n📥 导入 &#x2F; 导出（CSV&#x2F;XLSX）\n入口：系统设置 → 导入&#x2F;导出\n导入：支持 CSV&#x2F;XLSX；表头需与模板一致；可选字段 附件路径（用 ; 分隔多个文件的绝对路径）\n导出：导出文件包含 附件数量 与 附件路径；若要回导请确保附件文件在原路径可访问（跨机器需自行拷贝并修正路径）\n\n\n🤖 MCP 接入（本地）本项目内置了 MCP (Model Context Protocol) 服务，允许 AI Agent（如 Claude Desktop、Cursor 等）安全地读取本地荣誉数据与附件。\n🔌 连接方式\nstdio 模式（推荐）\n\n适用场景：本地客户端直接拉起进程（无需占用端口）。\n启动命令：uv run certificate-mcp\n配置示例：见下文“客户端配置示例”。\n\n\nSSE 模式（HTTP 服务）\n\n适用场景：本机调试（HTTP）。\n地址：http://127.0.0.1:8000/sse\n启动方式：\n自动（推荐）：在“设置页 → MCP 服务”中开启“随软件启动 MCP”。\n手动：CERT_MCP_TRANSPORT=sse uv run certificate-mcp\n\n\n日志：logs/mcp_sse.log\n注意：服务端强制本地绑定，CERT_MCP_HOST 只能是 127.0.0.1 &#x2F; localhost &#x2F; ::1，请勿暴露到公网。\n\n\nWindows PowerShell 手动启动命令\n\n$env:CERT_MCP_TRANSPORT = &quot;sse&quot;$env:CERT_MCP_HOST = &quot;127.0.0.1&quot;$env:CERT_MCP_PORT = &quot;8000&quot;uv run certificate-mcp\n\n\nWeb 控制台（调试用）\n\n功能：提供一个 Web 界面来测试 MCP 工具调用。\n安装：uv sync --group mcp-web（或在设置页点击安装）。\n启动：uv run certificate-mcp-web（默认访问 http://127.0.0.1:7860）。\n说明：无登录，仅用于本机调试；如关闭后端口仍占用见“故障排查”。\n\n\n\n🛡️ 权限与安全\n默认只读：默认不允许写入数据库或修改文件。如需开启写入（仅限本地），请在设置页勾选或设置环境变量 CERT_MCP_ALLOW_WRITE=1。\n隐私保护：默认开启 PII 脱敏（CERT_MCP_REDACT_PII=1），自动隐藏身份证号与手机号中间位。\n附件限额：单次读取附件最大 1MB（可配置 CERT_MCP_MAX_BYTES）。\n网络安全：服务默认绑定 127.0.0.1，请勿暴露到公网。\n\n🛠️ 能力概览\nTools (工具)：\nlist_awards &#x2F; get_award &#x2F; search_awards：查询荣誉记录。\nlist_members &#x2F; get_member：查询成员信息。\nread_attachment：读取附件内容（支持文本提取）。\nhealth：健康检查。\n\n\nResources (资源)：\ndocs://readme &#x2F; docs://agents：读取项目 README&#x2F;AGENTS 指南。\nschema://models：查看数据库模型定义。\ntemplates://awards_csv：获取导入模板。\n\n\n\n⚙️ 常用环境变量\n\n\n变量名\n说明\n默认值\n\n\n\nCERT_MCP_TRANSPORT\n传输模式 (stdio&#x2F;sse)\nstdio\n\n\nCERT_MCP_HOST\nSSE Host（仅允许本地）\n127.0.0.1\n\n\nCERT_MCP_PORT\nSSE 端口\n8000\n\n\nCERT_MCP_ALLOW_WRITE\n允许写入 (0&#x2F;1)\n0\n\n\nCERT_MCP_REDACT_PII\n敏感信息脱敏 (0&#x2F;1)\n1\n\n\nCERT_MCP_MAX_BYTES\n单次附件读取上限（字节）\n1048576\n\n\nCERT_MCP_DEBUG\n输出调试错误细节 (0&#x2F;1)\n0\n\n\nCERT_MCP_WEB_HOST\nWeb 控制台 Host\n127.0.0.1\n\n\nCERT_MCP_WEB_PORT\nWeb 控制台端口\n7860\n\n\nCERT_MCP_WEB_INBROWSER\n是否自动打开浏览器 (0&#x2F;1)\n1\n\n\n\n📎 客户端配置示例 (Claude Desktop / Cursor)\n\nstdio 模式 (推荐)：\n&#123;  &quot;mcpServers&quot;: &#123;    &quot;certificate&quot;: &#123;      &quot;command&quot;: &quot;uv&quot;,      &quot;args&quot;: [&quot;run&quot;, &quot;certificate-mcp&quot;],      &quot;env&quot;: &#123;        &quot;CERT_MCP_ALLOW_WRITE&quot;: &quot;0&quot;,        &quot;CERT_MCP_REDACT_PII&quot;: &quot;1&quot;      &#125;    &#125;  &#125;&#125;\n\nSSE 模式：\n&#123;  &quot;mcpServers&quot;: &#123;    &quot;certificate&quot;: &#123;      &quot;type&quot;: &quot;sse&quot;,      &quot;url&quot;: &quot;http://127.0.0.1:8000/sse&quot;    &#125;  &#125;&#125;\n\n\n\n📂 文件目录说明\n点击展开完整目录树\n\nCertificate-Management/├── 📄 README.md                    # 项目文档├── ⚙️ pyproject.toml               # 依赖配置├── 🔒 uv.lock                      # 依赖锁定├── 🚀 main.bat                     # Windows 启动脚本├── 🚫 .gitignore                   # Git 忽略规则├── 🧰 tools/                       # 开发辅助脚本（可选）│├── 📦 src/                         # 源代码│   ├── 🏁 main.py                  # 入口文件│   ├── 🌍 app_context.py           # DI 容器│   ├── ⚙️ config.py                # 配置加载│   ├── 📝 logger.py                # 日志配置│   ├── 🤖 mcp/                     # MCP 模块（本地）│   │   ├── server.py               # MCP 服务端（默认只读）│   │   ├── web.py                  # MCP 本地 Web 控制台（可选）│   │   ├── helpers.py              # MCP 配置/解析辅助│   │   └── runtime.py              # MCP 进程/自启动管理（本地）│   ││   ├── 💾 data/                    # 数据层│   │   ├── models.py               # SQLAlchemy 模型│   │   └── database.py             # 数据库会话│   ││   ├── 🔧 services/                # 业务层│   │   ├── award_service.py        # 荣誉逻辑│   │   ├── statistics_service.py   # 统计分析│   │   ├── import_export.py        # 导入导出│   │   ├── ai_certificate_service.py # AI 证书识别（OpenAI 兼容 API）│   │   ├── ai_provider_service.py  # AI Provider / Key 轮换│   │   ├── attachment_manager.py   # 附件存储/去重/回收站│   │   ├── backup_manager.py       # 备份/验证/恢复（含定时任务）│   │   ├── flag_service.py         # 自定义布尔开关（flag）│   │   └── ...│   ││   ├── 🎨 ui/                      # 表现层│   │   ├── main_window.py          # 主窗口│   │   ├── styled_theme.py         # 主题管理│   │   ├── pages/                  # 各功能页面│   │   └── widgets/                # 自定义组件│   ││   └── 📂 resources/               # 静态资源│       ├── styles/                 # QSS 样式│       └── templates/              # 导入模板│├── 📂 data/                        # 数据库存储 (自动生成)├── 📂 attachments/                 # 附件存储├── 📂 backups/                     # 自动备份├── 📂 logs/                        # 运行日志└── 📂 docs/                        # 文档与参考数据\n\n\n\n🏗️ 项目架构flowchart TD    subgraph UI [表现层 Presentation]        direction TB        MainWindow[主窗口 MainWindow]        Pages[页面 Pages]        Widgets[组件 Widgets]        Theme[主题 ThemeManager]    end    subgraph Service [业务层 Business Logic]        direction TB        AwardSvc[荣誉服务 AwardService]        StatSvc[统计服务 StatisticsService]        BackupSvc[备份服务 BackupManager]        ImportSvc[导入服务 ImportExport]        AttachSvc[附件服务 AttachmentManager]        FlagSvc[开关服务 FlagService]        AISvc[AI 证书识别 AICertificateService]    end    subgraph Data [数据层 Data Access]        direction TB        ORM[SQLAlchemy ORM]        SQLite[(SQLite Database)]    end    subgraph Integration [集成 Integration]        direction TB        MCP[MCP Server (FastMCP)]    end    UI --&gt; Service    Service --&gt; Data    MCP --&gt; Service        style UI fill:#e1f5fe,stroke:#01579b    style Service fill:#fff3e0,stroke:#ff6f00    style Data fill:#e8f5e9,stroke:#2e7d32    style Integration fill:#f3e5f5,stroke:#6a1b9a\n\n\n架构说明：本项目采用经典的三层架构（表现层、业务层、数据层），各层职责分明，通过依赖注入（DI）容器 AppContext 进行解耦。\n\n\n💾 数据模型\n查看详细数据库表结构\n\n🏆 荣誉记录 (Awards)\n\n\n字段\n类型\n说明\n\n\n\nid\nInteger\n主键\n\n\ncompetition_name\nString\n比赛名称\n\n\naward_date\nDate\n获奖日期\n\n\nlevel\nString\n级别（国家&#x2F;省&#x2F;校等）\n\n\nrank\nString\n等级（一&#x2F;二&#x2F;三&#x2F;优秀）\n\n\ncertificate_code\nString\n证书编号\n\n\nremarks\nText\n备注\n\n\nattachment_folder\nString\n附件目录相对路径\n\n\ndeleted &#x2F; deleted_at\nBool&#x2F;DateTime\n软删除标记\n\n\ncreated_at &#x2F; updated_at\nDateTime\n时间戳\n\n\naward_members\nRelation\n荣誉成员快照（AwardMember，级联删除）\n\n\nattachments\nRelation\n附件（级联删除）\n\n\n🧩 荣誉成员快照 (AwardMembers)\n\n\n字段\n类型\n说明\n\n\n\nid\nInteger\n主键\n\n\naward_id\nFK\n关联荣誉\n\n\nmember_id\nFK &#x2F; Nullable\n关联成员库（可空；未入库则为空）\n\n\nmember_name\nString\n当时录入的姓名快照（必填）\n\n\nsort_order\nInteger\n成员顺序\n\n\n👤 参与成员 (TeamMembers)\n\n\n字段\n类型\n说明\n\n\n\nid\nInteger\n主键\n\n\nname\nString\n姓名\n\n\ngender\nString\n性别\n\n\nid_card\nString\n身份证号（唯一）\n\n\nphone\nString\n手机号\n\n\nstudent_id\nString\n学号（唯一）\n\n\nemail\nString\n邮箱\n\n\nschool &#x2F; school_code\nString\n学校名称&#x2F;标识码\n\n\nmajor &#x2F; major_code\nString\n专业名称&#x2F;代码\n\n\nclass_name\nString\n班级\n\n\ncollege\nString\n学院\n\n\npinyin\nString\n姓名拼音\n\n\nactive\nBool\n启用状态\n\n\nsort_index\nInteger\n排序权重\n\n\ncreated_at &#x2F; updated_at\nDateTime\n时间戳\n\n\naward_associations\nRelation\n通过 AwardMember 关联荣誉（成员库可变更不影响历史快照）\n\n\n🤖 AI 提供商 (AIProviders)\n\n\n字段\n类型\n说明\n\n\n\nid\nInteger\n主键\n\n\nname\nString\n提供商名称（唯一）\n\n\napi_base\nString\nOpenAI 兼容 API Base\n\n\napi_keys\nText\n多 Key（支持 &#96;name\n\n\nmodel\nString\n默认模型 ID\n\n\npdf_pages\nInteger\nPDF 渲染页数（1~10）\n\n\nlast_key_index\nInteger\nKey 轮换索引（-1 表示未开始）\n\n\n\nsettings.ai_active_provider_id 用于标记当前激活的 provider；旧版单配置（ai_api_base/ai_api_key/ai_model）会在首次启动时迁移到默认 provider。\n\n🏷️ 自定义开关 (CustomFlags&#x2F;AwardFlagValues)\n\n\n模型\n关键字段\n说明\n\n\n\nCustomFlag\nkey(唯一), label, enabled, default_value, sort_order\n自定义布尔开关定义（用于录入&#x2F;导出&#x2F;筛选）\n\n\nAwardFlagValue\naward_id, flag_key, value\n荣誉对应的开关值（与 award_id+flag_key 唯一）\n\n\n🎓 专业与学校 (Majors&#x2F;Schools)\n\n\n模型\n关键字段\n说明\n\n\n\nMajor\nname(唯一), code(唯一), pinyin, category, discipline_code/name, class_code/name, 时间戳\n2025 本科专业目录（约 840 条）\n\n\nSchool\nname(唯一), code(唯一), pinyin, region, 时间戳\n全国高校列表\n\n\nSchoolMajorMapping\nschool_name/code, major_name/code, college_name, category, discipline_*, class_*\n学校-专业-学院映射，支持代码缺失时按名称回退\n\n\nAttachment\naward_id, stored_name, original_name, relative_path(唯一), file_md5, file_size, deleted, 时间戳\n附件记录\n\n\nBackupRecord &#x2F; ImportJob\n路径&#x2F;状态&#x2F;消息&#x2F;时间戳\n备份与导入任务记录\n\n\n(更多模型细节请查阅源码 src/data/models.py)\n\n\n\n🔐 数据安全与备份\n  \n    \n      \n        🛡️ 本地优先\n        数据存于 data/awards.db，附件在 attachments/，默认不上传云端。\n      \n      \n        🔄 自动备份\n        支持手动/启动时/每日/每周备份；基于 SQLite backup() 生成快照，并可在恢复前自动创建还原点。\n      \n    \n    \n      \n        🗑️ 回收站\n        删除荣誉进入回收站可恢复；附件删除会移入 attachments/.trash。\n      \n      \n        🧹 清理策略\n        提供日志/备份清空与数据库重建（reset）工具，均带双重确认；数据库清空会重建空库并重载默认设置。\n      \n    \n  \n\n\n\n⚠️ 隐私提醒：请勿将 data/、backups/、attachments/、logs/、.env 等敏感目录提交到版本控制系统。\n\n\n🎨 主题系统应用内置了一套精美的色彩系统，适配深色&#x2F;浅色模式。\n\n\n\n指标类型\n渐变色 (Light -&gt; Dark)\n语义\n\n\n\n总荣誉\n💜 #a071ff → #7b6cff\n综合实力\n\n\n国家级\n💙 #5a80f3 → #4ac6ff\n最高荣誉\n\n\n省级\n💛 #ffb347 → #ffcc33\n中坚力量\n\n\n校级\n💚 #3ec8a0 → #45dd8e\n基础积累\n\n\n一等奖\n💠 #00b4d8 → #48cae4\n顶尖表现\n\n\n二等奖\n💜 #b54cb8 → #d896ff\n稳定发挥\n\n\n三等奖\n❤️ #ff6b6b → #ff8787\n鼓励奖项\n\n\n优秀奖\n🤍 #999999 → #b3b3b3\n参与&#x2F;优秀\n\n\n\n🛠️ 开发指南\n环境准备: 确保 Python 3.14+，推荐使用 uv 管理虚拟环境。\n新增页面: 继承 BasePage，在 main_window.py 中注册路由。\n数据库变更: 修改 models.py，目前使用自动建表，生产环境建议引入 Alembic。\n代码规范: 提交前请运行 ruff check 和 pyright。\n版本与文档: 版本号统一来自 pyproject.toml（运行时由 src/version.py 读取）；升级版本时请同步更新 README 顶部&#x2F;更新日志与应用“关于”页文案。\n\n\n🧰 故障排查\n点击查看常见问题解决方案\n\n\n\n\n问题现象\n可能原因\n解决方案\n\n\n\n启动缺少 Qt 插件\n环境依赖不完整\n运行 uv sync，若无效则删除 .venv 重试\n\n\n界面文字乱码\n字体缺失或编码问题\n检查系统字体，确认未强制覆盖 QFontDatabase\n\n\n数据库被锁\n异常退出导致锁文件残留\n先关闭应用；仍锁时删除 data/awards.db-shm 和 .db-wal（恢复备份前程序会尝试清理这两类文件）\n\n\n导入无响应\n模板格式错误\n确认 CSV&#x2F;XLSX 表头与模板一致，查看设置页日志\n\n\nMCP 连接失败\n端口未启动&#x2F;URL 错误&#x2F;依赖缺失\nSSE：确认 http://127.0.0.1:8000/sse 且设置页已启动；Web：先 uv sync --group mcp-web，再启动 Web 控制台并访问 http://127.0.0.1:7860\n\n\nMCP Web 关闭后端口仍占用（7860）\n进程未退出&#x2F;残留子进程\n退出应用与相关终端后，用 netstat -ano | findstr :7860 查 PID，再 taskkill /PID &lt;pid&gt; /T /F\n\n\nMCP SSE 启动报 host 限制\nMCP 服务仅允许本地绑定\n将 CERT_MCP_HOST 设置为 127.0.0.1 &#x2F; localhost &#x2F; ::1（或直接用设置页启动）\n\n\nAI 识别提示缺少 PDF 依赖\n未安装 PyMuPDF\n运行 uv sync 安装依赖（需要识别 PDF 时必须）\n\n\nAI 识别失败：Cloudflare 1010\n网络&#x2F;代理&#x2F;风控拦截\n更换网络&#x2F;代理或更换中转；该错误通常与本机环境无关\n\n\nAI 识别失败：模型输出不是有效 JSON\n模型不按要求输出结构化结果\n更换模型&#x2F;提供商；确保模型支持图像输入，并尝试在设置页手动填写模型 ID\n\n\n主题不更新\n信号未连接\n检查 __init__ 是否连接 themeChanged 信号\n\n\n附件校验失败\n文件被占用或修改\n检查文件权限，清空回收站后重试\n\n\n\n\n\n📝 更新日志\n说明：以下版本号按 GitHub main 分支提交记录分段整理（无 Tag 时以日期为准），采用 SemVer（主版本&#x2F;次版本&#x2F;修订号）。\n\nv1.4.0 (2025-12-18)\nAI 证书识别\n荣誉录入页支持一键从证书图片&#x2F;PDF 抽取比赛名称、日期、级别、奖项、证书编号与成员姓名，并提供预览确认后再填充\nAI 设置页新增&#x2F;完善：多 Provider 管理（名称&#x2F;API 地址&#x2F;模型&#x2F;PDF 页数）、模型列表刷新&#x2F;选择、联通测试、API Key 多 Key 轮换\n\n\n运维与数据\n新增数据库 reset 与自定义布尔开关批量保存，便于清理与批处理\n修复奖项成员快照在部分路径下的赋值顺序问题\n\n\n文档\n修正目录锚点与奖项说明细节\n\n\n\n\n提交记录（v1.4.0，共 7 条）\n\n\ncde6154 2025-12-17 docs: 修正目录锚点与补充奖项说明\n47a45f0 2025-12-17 feat: 支持数据库 reset 与 flag 批量保存\n0a7abf4 2025-12-18 fix: 修正奖项成员快照赋值顺序\n9e0fde6 2025-12-18 feat: 增加 AI 证书识别与多 Provider 支持\ne70fa2c 2025-12-18 fix: 优化 AI 证书按钮与模型输入兼容性\nc0d2912 2025-12-18 fix: 优化 AI 密钥表格内容居中显示\n8a7c285 2025-12-18 refactor: 拆分 AI 设置表单结构\n\n\n\nv1.3.1 (2025-12-17)\n荣誉成员快照 &#x2F; 可选入库\n荣誉成员改为快照模型：荣誉始终保存 member_name，可选绑定成员库 member_id，成员库变更&#x2F;停用不影响历史荣誉显示\n录入页每个成员卡片新增“加入成员库”勾选（默认关闭），不入库时仅保存姓名；总览&#x2F;仪表盘&#x2F;导入导出同步适配\n\n\n性能&#x2F;体验\n页面引入懒加载占位页，并在启动后分批后台预热，显著降低首屏初始化压力\n专业&#x2F;学校搜索与仪表盘数据加载迁移到线程池异步执行，减少输入与切页时的 UI 阻塞\n页面切换时仅在可见页面运行刷新&#x2F;轮询定时器，修复“每 5 秒卡一下”的卡顿问题\n控制台日志格式更清晰（时间+等级对齐，可选颜色），过滤第三方提示信息，Windows 启动脚本成功退出不再强制暂停\n\n\n数据安全\n备份改用 SQLite backup() 快照生成，避免 WAL 模式下直接复制 awards.db 可能导致的不一致\n\n\n稳定性\n修复 run_in_thread() 线程池任务回调偶发丢失（worker 生命周期过短导致未回调）\n修复部分类型标注在运行时导入触发 NameError 的问题（提升对不同 Python 版本的兼容性）\n\n\nMCP\n附件读取工具返回信息更准确，并跟随设置页配置的附件目录工作（修改目录后重启 MCP 生效）\n\n\n工程化\n规范化版本号管理，统一从 pyproject.toml 读取，窗口标题显示版本号\n\n\n文档\n修正 README 段落缩进与更新日志结构，补齐各版本提交记录\n完善 MCP&#x2F;AI 接入与本地安全说明（仅本地使用，保持绑定 127.0.0.1）\n\n\n\n\n提交记录（v1.3.1，共 7 条）\n\n\n1bb7c41 2025-12-17 feat: 荣誉成员支持快照与可选入库\n1ae5479 2025-12-17 feat: 优化页面加载与错误处理，提升性能\nac8cc5c 2025-12-17 feat: 优化日志输出与懒加载页面体验\n25041a0 2025-12-17 chore: 规范化版本号管理 (v1.3.1)\nf6b55c3 2025-12-17 feat: 优化荣誉成员快照与页面性能\nef15694 2025-12-17 docs: 修正 README.md 段落缩进与更新日志\n4ed0e17 2025-12-17 docs: 完善 MCP&#x2F;AI 接入与安全说明\n\n\n\nv1.3.0 (2025-12-16)\nMCP 接入\n新增本地 MCP 服务（stdio&#x2F;SSE），默认只读；支持敏感信息脱敏与附件读取限额\n新增可选 Web 控制台（Gradio），用于本机调试 MCP 输出（无登录，仅本地）\n设置页集成 MCP 管理（随软件启动、端口&#x2F;权限&#x2F;脱敏配置、日志入口、Web 依赖一键安装&#x2F;更新）\n\n\n工程化与结构\nMCP 相关代码整理到 src/mcp/，统一模块命名与脚本入口（certificate-mcp &#x2F; certificate-mcp-web）\nMCP 进程与 Web 控制台运行日志落盘（logs/mcp_sse.log、logs/mcp_web.log、logs/mcp_web_install.log）\n\n\n细节修复\n修复导入模板与设置页布局细节，优化 MCP 说明与使用指引\n\n\n\n\n提交记录（v1.3.0，共 5 条）\n\n\nf6086cd 2025-12-16 feat: 集成 MCP 服务及本地 Web 控制台\n2ed061f 2025-12-16 feat: 增强 MCP 进程管理与敏感信息脱敏\n493d310 2025-12-16 feat: 优化 MCP 说明与 Web 控制台操作\n5a2a907 2025-12-16 refactor: MCP 相关模块目录结构调整与功能优化\n35f397c 2025-12-16 chore: 更新版本号至 1.3.0 并补充更新日志\n\n\n\nv1.2.0 (2025-12-14)\n新增：自定义布尔开关（CustomFlag &#x2F; AwardFlagValue）及与荣誉记录关联\n新增：设置页开关管理界面（改名、启用、默认值、排序、删除双重确认）\n增强：录入页&#x2F;导入导出支持开关值读写，统计与相关逻辑同步完善\n\n\n提交记录（v1.2.0，共 1 条）\n\n\n86f6d01 2025-12-14 feat: 增加自定义布尔开关及荣誉关联\n\n\n\nv1.1.0 (2025-12-09 ~ 2025-12-10)\n新增：批量管理（全选&#x2F;反选&#x2F;全不选）与成员排序优化\n新增：荣誉&#x2F;成员全文检索（FTS5）与导入流程优化\n增强：附件去重（含按奖项限定）与备份&#x2F;恢复体验优化\n增强：主窗口导航快捷键、自动备份选项、LOGO 与文档说明完善\n\n\n提交记录（v1.1.0，共 15 条）\n\n\n3c1aa2f 2025-12-09 feat: 批量管理与成员排序功能优化\ndf74008 2025-12-09 feat: 批量管理支持全选&#x2F;反选&#x2F;全不选\n8848538 2025-12-09 refactor: 优化最新荣誉查询逻辑\nc18bc0e 2025-12-09 feat: 学校与专业导入及数据模板完善\ncf09d34 2025-12-10 feat: 附件去重与备份恢复功能优化\n2c7ad87 2025-12-10 feat: 附件查重支持按奖项限定\n193a4cb 2025-12-10 feat: 增加主窗口导航快捷键与备份自动备份选项\n661c30e 2025-12-10 feat: 荣誉与成员全文搜索及导入优化\n85a4fe7 2025-12-10 feat: 更新 LOGO 与设置&#x2F;搜索功能说明\n3de33e0 2025-12-10 docs: 优化 README LOGO 展示布局\n67a5bc6 2025-12-10 docs: 优化 README 顶部布局与徽章展示\n15b3aed 2025-12-10 docs: 完善数据模型与目录说明\n901b405 2025-12-10 docs: 修正 README 顶部打字动画内容编码\nb3616d7 2025-12-10 docs: 完善数据模型说明并删除测试脚本\nb530069 2025-12-10 chore: 更新 .gitignore 及 AGENTS.md 数据目录说明\n\n\n\nv1.0.1 (2025-12-04 ~ 2025-12-07)\n体验优化：表单&#x2F;仪表盘&#x2F;列表 UI 大量调整，表格迁移至 QTableView 并支持居中显示\n主题&#x2F;性能：浅色表格修复、深色背景调整、减少模糊特效避免掉帧、动画更顺滑\n数据能力：专业库 Excel 导入与统计展示、附件表格支持拖拽添加\n工程化：依赖管理切换为 pyproject.toml + uv，集成 Ruff&#x2F;Pyright；构建系统切换为 setuptools\n稳定性：支持信号中断安全退出，修复字体重置、总览页附件显示等问题\n\n\n提交记录（v1.0.1，共 61 条）\n\n\ne0c1b33 2025-12-04 修复操作细节\n6e90000 2025-12-04 逻辑优化\n1b492fd 2025-12-04 无更新\nef0b2d4 2025-12-04 Remove docs folder\n75a6902 2025-12-04 feat: 添加文档导入功能和邮箱自动生成\n55bc0fd 2025-12-04 修复小BUG\n5297fcf 2025-12-04 修复小BUG\na29a915 2025-12-05 修复总览页不显示附件的BUG\n68318b7 2025-12-05 优化体验\n7176bd5 2025-12-05 加入关于页\nf4fa0fd 2025-12-05 提供个人信息模板\ndc4161a 2025-12-05 更新排序功能\n584f049 2025-12-05 更新文本\na8c8af5 2025-12-05 更新细节\n05d60b1 2025-12-05 RM更新\n85f6fe9 2025-12-05 RM更新\n3260af5 2025-12-05 fix: 移除模糊特效防止掉帧\n9b25efa 2025-12-05 fix: 优化备份目录配置容错处理\nc751e23 2025-12-05 feat: 支持logo随主题切换\n69d383d 2025-12-05 fix: 防止动画中卡顿\n4729233 2025-12-05 refactor: 全面替换表格为QTableView并引入模型\nf2363bb 2025-12-05 refactor: 优化表单与仪表盘UI及交互\n93537a2 2025-12-05 refactor: 表单控件统一为qfluentwidgets组件\nbe6c61a 2025-12-05 refactor: 统一成员卡片样式为QSS卡片属性\na80e672 2025-12-05 refactor: 隐藏日期选择器符号按钮\n79b65ae 2025-12-05 refactor: 优化搜索框与荣誉卡片样式\n48a3e17 2025-12-05 refactor: 设置全局字体避免警告\ndbc5819 2025-12-05 fix: 修复字体重置的问题\nf61e75c 2025-12-05 fix: 移除弹窗模糊特效防止掉帧\n958aea2 2025-12-05 chore: 切换依赖管理为 pyproject.toml+uv\n6afce89 2025-12-05 refactor: 移除表情符号并优化注释\n49358ff 2025-12-05 refactor: 精简注释与优化代码结构\n6ee169e 2025-12-05 chore: 调整ruff配置项位置\n2d9fe94 2025-12-05 refactor: 统一导航方法为navigate_to\nc79858a 2025-12-05 style: 统一代码风格与格式优化\n893226f 2025-12-05 refactor: 优化类型导入与异常处理\n6905e1a 2025-12-05 refactor: 统一文件操作与类型注解优化\n4fb64e9 2025-12-05 docs: 重命名 agents.md 至 AGENTS.md\na348921 2025-12-06 docs: 更新 AI 开发指南\nb3ea343 2025-12-06 docs: 更新数据模型与依赖说明\n19096b8 2025-12-06 chore: 移除 ruff 配置中的 PL 规则\n775c69c 2025-12-06 refactor: 精简条件表达式与移除无用Tag相关方法\nc17746a 2025-12-06 feat: 集成 Pyright 类型检查支持\n330c982 2025-12-06 refactor: 适配 PySide6 新版 API 与类型注解优化\n139ab0d 2025-12-06 refactor: 移除 future annotations 导入\n66d29cc 2025-12-06 refactor: 优化页面初始化与导航栏注册\n8e93328 2025-12-06 feat: 优化页面切换动画\n1bba145 2025-12-06 style: 调整深色主题主背景色\n7756c10 2025-12-06 fix: 修复表格亮色模式\n6c048e0 2025-12-06 feat: 支持信号中断安全退出\na91ebd1 2025-12-06 feat: 真正的 Fluent Design 切换动画\n57bef83 2025-12-06 Merge pull request #1 from zetaloop&#x2F;refactorxx\n20e1a66 2025-12-07 chore: 启动脚本增加虚拟环境激活\n7d6b279 2025-12-07 chore: 格式化依赖配置与部分代码结构\na235df8 2025-12-07 chore: 切换构建系统为 setuptools\n2eeb63e 2025-12-07 feat: 附件表格支持拖拽添加文件\ne526e91 2025-12-07 feat: 表格内容居中显示\n27755da 2025-12-07 refactor: 优化类型导入与依赖\n07d3ccc 2025-12-07 feat: 专业库支持 Excel 导入与统计展示\nda71f6d 2025-12-07 refactor: 专业库导入脚本迁移与优化\n61d99e9 2025-12-07 refactor: 优化 test_majors.py 导入与格式\n\n\n\nv1.0.0 (2025-12-02 ~ 2025-12-03)\n初版完成：基础页面、主题样式与主要组件搭建\n文档：引入 AGENTS.md，为 AI&#x2F;自动化开发提供项目导航与规范\n\n\n提交记录（v1.0.0，共 10 条）\n\n\ne30a773 2025-12-02 V1.0 创建\n81e6477 2025-12-02 添加主题样式和页面组件功能\n27071ef 2025-12-02 Clean up: remove unused files and configure .gitignore for sensitive data\n2643a2d 2025-12-02 chore: remove .codemap from version control\n9d38507 2025-12-02 更新细节\n85d8e2f 2025-12-03 feat: implement comprehensive code improvements\ncd2214b 2025-12-03 细节修复\na9a6fc9 2025-12-03 细节修复\nca924ab 2025-12-03 大版本V1.0完成\n5d6f019 2025-12-03 创建agents.md为AI开发提供便利\n\n\n\n\n📈 Star History\n \n   \n   \n   \n \n\n\n\n🤝 如何贡献非常欢迎您的贡献！请遵循以下流程：\n\nFork 本仓库\n创建特性分支 (git checkout -b feature/AmazingFeature)\n提交更改 (git commit -m &#39;Add some AmazingFeature&#39;)\n推送到分支 (git push origin feature/AmazingFeature)\n提交 Pull Request\n\n\n📄 许可证本项目基于 MIT License 开源。\n\n\n  \n    Author: RE-TikaRa |\n    Powered by: PySide6 & QFluentWidgets\n  \n  \n  \n    \n      \n    \n    \n      \n    \n  \n\n","categories":["Project"],"tags":["Project"]},{"title":"LaTeX学习日志01-前期准备","url":"/Blog/posts/828fd9e/","content":"前言LaTeX 是基于 TeX 的排版系统，用纯文本加命令写作，排版统一且可复用。它会编译为高质量 PDF，尤其适合公式、参考文献和长文档，也便于后期统一调整格式。写作时可更专注内容，把样式交给工具处理。本文记录在 Windows 11 上使用 Tectonic + VS Code + LaTeX Workshop 的前期准备流程。\n◆❖◆\n\n准备清单\nTectonic（LaTeX 引擎）\nVS Code\nLaTeX Workshop 插件\n环境变量 Path（用于命令行调用）\n\n◆❖◆\n\n安装 Tectonic\n打开 Tectonic 官网，点击 Install Tectonic 0.15.0 进入安装页面。\n\n\n\n我更推荐在 GitHub Release 下载。点击 find the latest released binaries on GitHub 进入发行页。\n\n\n\n在发布页找到 Assets。\n\n\n\nWindows 11 x64 建议下载 tectonic-0.15.0-x86_64-pc-windows-msvc.zip（官方 MSVC 原生构建，兼容性最好）。\n\n\n\n解压后将 tectonic.exe 放到固定路径，例如 C:\\Tectonic。\n把该路径加入系统环境变量 Path。\n\n\n\n（可选）命令行验证：tectonic --version。\n\n◆❖◆\n\n安装 VS Code 与 LaTeX Workshop在 VS Code 扩展中搜索并安装 LaTeX Workshop 插件。\n\n安装完成后，使用快捷键 Ctrl+Shift+P 打开用户设置（JSON）。\n\n◆❖◆\n\n配置 LaTeX Workshop找到下面类似的配置，没有的话可以直接复制并按需调整。注意 JSON 语法，不确定就发给 AI 帮你检查。\n&#123;  &quot;workbench.editorAssociations&quot;: &#123;    &quot;*.pdf&quot;: &quot;latex-workshop-pdf-hook&quot;  &#125;,  &quot;latex-workshop.intellisense.biblatexJSON.replace&quot;: &#123;&#125;,  &quot;latex-workshop.latex.tools&quot;: [    &#123;      &quot;name&quot;: &quot;tectonic&quot;,      &quot;command&quot;: &quot;tectonic&quot;,      &quot;args&quot;: [        &quot;--synctex&quot;,        &quot;--keep-logs&quot;,        &quot;--print&quot;,        &quot;%DOC%.tex&quot;      ],      &quot;env&quot;: &#123;&#125;    &#125;  ],  &quot;latex-workshop.latex.recipes&quot;: [    &#123;      &quot;name&quot;: &quot;tectonic&quot;,      &quot;tools&quot;: [&quot;tectonic&quot;]    &#125;  ],  &quot;latex-workshop.view.pdf.internal.synctex.keybinding&quot;: &quot;double-click&quot;,  &quot;[latex]&quot;: &#123;    &quot;editor.formatOnSave&quot;: false  &#125;,  &quot;latex-workshop.latex.autoBuild.run&quot;: &quot;onSave&quot;,  &quot;latex-workshop.latex.autoBuild.interval&quot;: 500&#125;\n\n完成后保存即可。之后保存 .tex 文件会自动调用 Tectonic 编译，并在 VS Code 内部预览 PDF。\n","categories":["Latex"],"tags":["LaTeX"]},{"title":"DesktopTimer","url":"/Blog/posts/998ef9dc/","content":"\n   \n      \n   \n   \n      \n   \n   \n      \n   \n   \n      \n   \n   \n      \n   \n\n\n\n\nDesktopTimer | 桌面计时器\n\n\n基于 PyQt5 的轻量级桌面计时器，支持正计时/倒计时/时钟模式，系统托盘、快捷键、音效与闪烁提醒、多语言（中/英）以及丰富的外观自定义。\n\n\n\n  下载最新版本 •\n  查看源码 •\n  报告 Bug •\n  提出新特性\n\n\n\n本 README 同时面向“用户”和“开发者”，上来就想用的看“快速开始”，想参与开发的看“开发者指南”。\n\n\n🚀 快速开始（用户）\n支持系统：Windows 10&#x2F;11（x64）\n推荐环境：Python 3.13（仅源码运行需用到），普通用户可直接使用安装包或便携版\n\n\n安装程序（建议）\n\n\n前往 Releases 下载 DesktopTimer-Setup.exe\n双击安装，按向导完成；从开始菜单或桌面快捷方式启动\n\n\n便携版\n\n\n下载 DesktopTimer.zip → 解压 → 直接运行 DesktopTimer.exe\n\n\n从源码运行（开发者）\n\n\n克隆仓库并安装依赖后运行 main.py（见下文“开发者指南”）\n\n\n✨ 功能一览\n⏰ 三种计时：正计时、倒计时、时钟（12&#x2F;24 小时制、可选“秒&#x2F;日期”）\n🔔 提醒方式：自定义音效、系统 Beep、窗口闪烁、托盘气泡、Windows 通知\n🌐 双语言：中文 &#x2F; English 一键切换\n🎯 预设管理：设置页支持自定义&#x2F;排序倒计时预设，可为中&#x2F;英文界面分别命名并同步托盘快捷菜单\n🎨 外观：字体&#x2F;字号、颜色、圆角、透明度、夜读模式、窗口尺寸\n🧰 系统托盘：暂停&#x2F;继续、重置、模式切换、倒计时预设（含自定义单次输入）、显示&#x2F;隐藏、锁定&#x2F;解锁、打开设置、退出\n🔒 窗口锁定：固定位置并可启用“点击穿透”\n⌨️ 快捷键：常用操作一键直达\n🖥️ 全屏模式：F11 一键切换，简拍&#x2F;展示更方便\n\n\n🧭 使用说明（核心操作）\n设置倒计时：输入小时&#x2F;分钟&#x2F;秒\n开始计时：点击“开始”或使用快捷键（见下）\n暂停&#x2F;恢复：点击“暂停”，或同一快捷键切换\n停止计时：点击“停止”\n窗口锁定：点击锁图标、按 Ctrl+L，或通过托盘菜单\n切换模式：在“设置”中选择“正计时&#x2F;倒计时&#x2F;时钟”\n配置保存：所有设置自动保存至 settings/timer_settings.json\n\n⌨️ 快捷键\n\n\n快捷键\n功能\n\n\n\nCtrl+Space\n暂停&#x2F;继续\n\n\nCtrl+R\n重置\n\n\nCtrl+H\n显示&#x2F;隐藏窗口\n\n\nCtrl+L\n锁定&#x2F;解锁窗口\n\n\nCtrl+,\n打开设置\n\n\nF11\n全屏&#x2F;退出全屏\n\n\n\n🛠️ 开发者指南开发环境要求\nPython 3.13 或更高版本\nWindows 10&#x2F;11\n建议使用虚拟环境（venv&#x2F;conda）\n\n源码运行# 克隆与进入目录git clone https://github.com/RE-TikaRa/DesktopTimer.gitcd DesktopTimer# 安装依赖pip install -r requirements.txt# 运行python main.py# 如需调试日志，可在运行前设置环境变量# PowerShell$env:DESKTOPTIMER_DEBUG=1# CMDset DESKTOPTIMER_DEBUG=1\n\n打包为可执行文件python -m PyInstaller DesktopTimer.spec --noconfirm\n打包完成后生成 dist/DesktopTimer.exe。请将 img/、lang/、sounds/ 一并放入 dist/ 目录。\n文件结构DesktopTimer/├── main.py           # 程序入口├── /module/          # 拆分逻辑（app/窗口/配置等）│   ├── __init__.py│   ├── app.py│   ├── constants.py│   ├── localization.py│   ├── paths.py│   ├── settings_dialog.py│   └── timer_window.py├── DesktopTimer.spec          # PyInstaller 配置├── requirements.txt           # Python 依赖├── README.md                  # 项目说明├── /img/                      # 图标资源│   ├── timer_icon.ico│   └── ALP_STUDIO-logo-full.svg├── /lang/                     # 语言包│   ├── zh_CN.json│   └── en_US.json├── /sounds/                   # 提醒音├── /settings/                 # 用户运行时配置│   └── timer_settings.json├── /build/                    # 临时构建文件└── /dist/                     # 打包输出\n\n架构与实现要点\ni18n：多语言加载（lang&#x2F;*.json）\nSettingsDialog：设置对话框（外观&#x2F;模式&#x2F;预设&#x2F;通用&#x2F;关于）\nTimerWindow：主窗口&#x2F;计时&#x2F;托盘&#x2F;提醒&#x2F;快捷键（含模式切换菜单、倒计时预设与自定义单次输入）\n路径管理：自动识别开发&#x2F;打包环境，动态定位资源\n配置管理：JSON 持久化，包含版本兼容处理\n\n要点：使用 sys.frozen 识别打包环境；相对路径存储确保可移植；QTimer&#x2F;QMediaPlayer&#x2F;QSystemTrayIcon 组合；自动从 v1.0.0 设置迁移到 v1.0.1。\n\n📦 打包与发布\n使用 DesktopTimer.spec 进行 onefile 打包，输出 dist/DesktopTimer.exe\n将 img/、lang/、sounds/ 复制到 dist/ 下，确保资源可用\n可使用 Inno Setup 生成安装程序（参考 setup/SetUp.iss）\n\n\n❓ 常见问题（FAQ）\n打包后没有声音&#x2F;语言不生效？\n\n请确认已将 img/、lang/、sounds/ 整个目录复制到 dist/。\n\n\n托盘图标不显示&#x2F;找不到？\n\n检查系统托盘的“隐藏的图标”区域；确保 Explorer 正常；程序最小化到托盘时可通过 Ctrl+H 显示&#x2F;隐藏。\n\n\n锁定后无法操作窗口怎么办？\n\n使用快捷键 Ctrl+L 解锁，或通过系统托盘菜单解锁。\n\n\n源码运行报依赖错误？\n\n重新执行 pip install -r requirements.txt，确保网络正常；如仍失败，建议新建虚拟环境后再安装。\n\n\n打包后资源路径异常？\n\n本项目已兼容 sys.frozen 场景；若自定义了运行目录，请保持资源与可执行文件同级。\n\n\n切换语言后界面没变化？\n\n语言下拉框一旦切换就会立即应用到主窗口与托盘；若仍看到旧语言，可确认设置文件是否可写或查看日志输出。\n\n\n\n\n🧭 开发路线图✅ 已完成功能\n正计时&#x2F;倒计时&#x2F;时钟三种模式\n系统托盘常驻与快捷操作\n多种提醒方式（音效&#x2F;闪烁&#x2F;通知）\n中英文双语支持\n外观完全自定义\n快捷键支持\n番茄钟快捷预设\n窗口锁定功能（位置固定 + 点击穿透）\n快捷键自定义\n托盘模式切换与即席自定义倒计时\n预设支持中英文双描述，可在创建时同步填写\n\n📌 计划中的功能\n结束提醒增强：音量、循环次数、渐入渐出；播放列表&#x2F;多音频轮播\nWindows 原生通知按钮（如“再来 5 分钟”“停止”）\n托盘与主题：暗&#x2F;亮主题托盘图标，自定义图标包\n设置管理：设置导出&#x2F;导入备份，一键恢复默认\n自动更新：检查 Releases 新版本并提示下载\n开机自启动（用户可选）\n多语言扩展：支持更多语言（日文、韩文等）\n可视化窗口滑块：为字体&#x2F;窗口大小提供滑块+“恢复默认”按钮，并显示实时数值\n全屏专用主题：进入全屏时可使用独立的背景&#x2F;文字&#x2F;透明度样式\n自定义快捷预设：允许用户在设置中增删 Pomodoro 预设并同步到托盘&#x2F;右键菜单\n配置导入&#x2F;导出：一键备份或应用 settings/*.json，方便在不同设备间迁移\n预设导入&#x2F;导出能力（JSON 备份&#x2F;恢复）\n预设列表排序、搜索或分组功能\n语言切换提示（关闭设置前提醒“需点击应用&#x2F;确定”）\n设置中添加调试日志开关（无需依赖环境变量）\n更易用的预设多语言编辑视图（统一列表，可批量维护）\n替换 win10toast 或移除其中的 pkg_resources 依赖以适配未来环境\n\n\n🧩 使用到的技术栈\nPyQt5 - GUI 框架\nPyInstaller - 打包工具\nwin10toast - Windows 通知（可选）\nInno Setup - 安装程序制作\n\n\n🗓️ 版本更新日志v1.0.4 (2025-11-28)\n⚙️ 预设编辑器支持多语言独立名称，可添加&#x2F;移除任意语言描述，并给出显式提示避免误填\n🪵 日志体系切换至 logging，设置 DESKTOPTIMER_DEBUG=1 即可启用 DEBUG 日志\n🌐 设置页语言切换支持即时预览但不会自动保存，FAQ 中新增说明\n🔊 随机铃声、声音播放、托盘通知等异常统一纳入日志输出，取代零散的 print\n\nv1.0.3 (2025-11-23)\n⚡️ 窗口大小控件更加可视，滑块+“恢复默认”快速调整字号\n🖥️ F11 一键全屏，锁定&#x2F;拖动逻辑和透明度自适应\n📐 托盘&#x2F;右键“快捷预设”按模式分组，可快捷切换正计时&#x2F;倒计时&#x2F;时钟\n🔧 README&#x2F;安装脚本版本信息统一至 1.0.3\n\nv1.0.2 (2025-10-10)\n⌨️ 新增自定义快捷键功能，支持个性化按键映射\n⏰ 优化时钟模式显示和交互体验\n✨ 重新设计关于页面，添加专业的 UI 布局和 ALP STUDIO 标识\n🔧 优化版本常量管理，统一版本信息展示\n📝 完善项目文档和用户界面体验\n\nv1.0.1 (2025-10-09)\n✨ 新增时钟模式，支持 12&#x2F;24 小时制、显示秒数、显示日期\n✨ 新增窗口锁定功能，支持点击穿透和多种解锁方式\n优化路径处理机制，改为相对路径存储\n添加 v1.0.0 配置自动兼容转换\n编译模式改为单文件 + 外部资源\n安装程序保护用户自定义音效和设置\n添加详细的升级指南文档（UPGRADE_GUIDE.md）\n\nv1.0.0 (2025-01-08)\n⏰ 基础倒计时功能\n⏱️ 正计时模式\n多种提醒音选择\n中英文双语支持\n窗口透明度和置顶功能\n系统托盘支持\n\n\n🤝 贡献指南欢迎通过 Issues 或 Pull Requests 参与贡献！\n如何参与开源项目\nFork 本仓库\n新建分支：git checkout -b feature/your-feature\n提交改动：git commit -m &quot;feat: your message&quot;\n推送分支：git push origin feature/your-feature\n发起 Pull Request\n\n\n🔖 版本控制项目使用 Git 管理版本；发布版本在 Releases&#x2F;Tags 标注。\n\n👤 作者TikaRa📧 邮箱：163mail@re-TikaRa.fun🌐 个人网站：https://re-tikara.fun🐙 GitHub：https://github.com/RE-TikaRa/DesktopTimer📺 B 站主页：https://space.bilibili.com/374412219\n\n📄 版权说明本项目采用「非商用许可」：DesktopTimer Non-Commercial License 1.0（DNCL-1.0）。\n允许：个人或非商用场景下免费使用、复制、修改与再分发（需保留版权和许可声明，并进行署名）\n禁止：任何形式的商用使用（含出售、付费分发、内含付费功能的再打包等）除非获得作者书面授权\n商用授权：如需商用，请联系作者获取授权：163mail@re-TikaRa.fun\n完整条款参见仓库中的 LICENSE 文件。\n\n🙏 鸣谢\nPyQt5 - 提供强大的 GUI 框架\nPyInstaller - Python 打包为可执行文件\nQt - 跨平台 GUI 框架\nInno Setup - Windows 安装程序制作工具\nShields.io - 项目徽章\nGitHub Pages - 文档托管\n\n","categories":["Project"],"tags":["project"]},{"title":"FileLocksmith-单文件版本","url":"/Blog/posts/5d98e7ac/","content":"File Locksmith 是用于定位并解除文件&#x2F;文件夹占用的工具。\n项目信息\n原始项目仓库：https://github.com/microsoft/PowerToys\n拆分自 PowerToys 0.97.1 的 File Locksmith\n目标环境：Windows 11 24H2 26100.7623\n\n下载方式一：下载发布包（推荐）Releases：https://github.com/RE-TikaRa/FileLocksmith/releases\n\nFileLocksmith Portable version：自带依赖，开箱即用，体积更大  \nFileLocksmith System dependency versions：不带运行库，体积更小，需要系统已安装依赖  \n依赖：Windows App SDK Runtime、VC++ 运行库、WebView2 Runtime\n\n\n\n方式二：获取源码用于自行构建或二次开发：\ngit clone https://github.com/RE-TikaRa/FileLocksmith.git\n\n界面预览首页\n设置页\n关于页\n功能概览\n右键菜单：快速定位占用文件&#x2F;文件夹的进程并处理\n扫描界面：展示占用进程、文件列表，可结束进程\n管理主界面：统一管理注册状态与显示方式\n支持“仅扩展菜单显示”（Win11“显示更多选项”）\n支持提升权限完成注册&#x2F;卸载与系统进程查看\n\n运行方式\n直接运行：启动管理主界面\n从右键菜单启动：进入扫描&#x2F;解锁界面\nCLI：FileLocksmithCLI.exe\n\n依赖说明\n本项目已尽量对关键依赖进行本地化与版本固定，以降低外部环境变化带来的不确定性。但由于 Windows SDK、运行库与系统环境差异较大，仍可能出现未覆盖的构建或运行问题。本地化范围主要包含仓库内置的 C++ 依赖（如 deps/spdlog、deps/expected-lite）以及明确的 NuGet 版本锁定。仍需在线还原的依赖以 Directory.Packages.props&#x2F;packages.config 为准。如遇异常，请提交 issue 并附上系统版本、构建日志或崩溃日志，便于定位与完善。\n\n构建环境\n\nWindows 11 + Visual Studio 2022（Build Tools 或 Professional，含 C++ 工具集与 MSBuild）\n.NET SDK 9（TargetFramework: net9.0-windows10.0.26100.0）\nWindows 11 SDK（WindowsSdkPackageVersion: 10.0.26100.68-preview）\nPowerShell 5+（便携包脚本）\n\n核心依赖（NuGet&#x2F;源码）\n\nWindows App SDK 1.8.251106002\nC#&#x2F;WinRT Microsoft.Windows.CsWinRT 2.2.0\nC++&#x2F;WinRT Microsoft.Windows.CppWinRT 2.0.240111.5\nWIL Microsoft.Windows.ImplementationLibrary 1.0.231216.1\nUI 组件：CommunityToolkit.WinUI.*、WinUIEx\nC++ 依赖（仓库内置）：deps/spdlog、deps/expected-lite\n\n运行时依赖\n\nWindows App SDK Runtime（便携包内会自带）\nVC++ 运行库（便携包脚本会尝试复制）\nWebView2 Runtime（WinUI WebView2）\n\n配置与数据位置（独立路径）根目录%LocalAppData%\\\\ALp_Studio\\\\FileLocksmith\n设置文件file-locksmith-settings.json\n\nEnabled：是否启用\nshowInExtendedContextMenu：仅扩展菜单显示\n\n运行数据last-run.log：上次选择路径列表（UTF-16 + 换行，空行终止）\n日志\n\nLogs\\\\log.log（原生日志）\nLogs\\\\Log_YYYY-MM-DD.log（托管日志）\n不再使用版本子目录，历史的 Logs\\\\&lt;版本&gt; 可删除。\n\n\n\n组策略（GPO）管理员可通过策略强制启用&#x2F;禁用：\nHKLM\\\\Software\\\\Policies\\\\FileLocksmith\n\nEnabled（DWORD）：1 启用，0 禁用若存在该键值，将覆盖本地设置。\n\n注册表标记（状态）用于记录右键菜单注册状态（脚本写入）：\nHKCU\\\\Software\\\\FileLocksmith\n\nContextMenuRegistered（DWORD）\n\nCLI 使用FileLocksmithCLI.exe [选项] &lt;路径1&gt; [路径2] ...选项:  --kill      结束占用文件的进程  --json      以 JSON 格式输出结果  --wait      等待文件解锁  --timeout   --wait 的超时（毫秒）  --help      显示帮助\n\n结构速览\nsrc/modules/FileLocksmith/FileLocksmithUI\n管理主界面与 WinUI 视图\n\n\nsrc/modules/FileLocksmith/FileLocksmithContextMenu\n右键菜单（Win11）\n\n\nsrc/modules/FileLocksmith/FileLocksmithExt\n右键菜单（经典）\n\n\nsrc/modules/FileLocksmith/FileLocksmithLib\n原生核心逻辑（句柄枚举&#x2F;扫描）\n\n\nsrc/modules/FileLocksmith/FileLocksmithLibInterop\n原生互操作层（WinRT）\n\n\nsrc/modules/FileLocksmith/FileLocksmithCLI\n命令行与单元测试\n\n\ntools/FileLocksmithPortable\n便携版打包脚本\n\n\n\n构建与打包项目使用 WinUI 3 + Windows App SDK（.NET 9 目标）。\n输出目录\n\nUI：x64/Release/WinUI3Apps\nCLI：x64/Release/FileLocksmithCLI.exe\n便携包（自带依赖）：artifacts/FileLocksmith Portable version/x64/Release\n便携包（系统依赖）：artifacts/FileLocksmith System dependency versions/x64/Release\n\n快捷脚本\n\n仅构建 UI：build_project.bat\n构建 + 便携版打包：build_and_pack.bat（输出 Portable&#x2F;System 两个版本）\n\n清理缓存（推荐在重新构建前执行）\n\n删除 x64/\n删除 artifacts/FileLocksmith Portable version/\n删除 artifacts/FileLocksmith System dependency versions/\n删除 src/**/bin 与 src/**/obj\n删除旧版日志子目录 Logs\\\\&lt;版本&gt;（如果仍存在）\n\n构建 UI（Release x64）\n&quot;C:\\\\Program Files\\\\Microsoft Visual Studio\\\\2022\\\\Professional\\\\MSBuild\\\\Current\\\\Bin\\\\MSBuild.exe&quot; src/modules/FileLocksmith/FileLocksmithUI/FileLocksmithUI.csproj /restore /p:Configuration=Release /p:Platform=x64 /p:RunAnalyzers=false /p:RunCodeAnalysis=false /p:EnableNETAnalyzers=false /p:EnforceCodeStyleInBuild=false /p:TreatWarningsAsErrors=false\n\n构建 CLI（Release x64）\n&quot;C:\\\\Program Files\\\\Microsoft Visual Studio\\\\2022\\\\Professional\\\\MSBuild\\\\Current\\\\Bin\\\\MSBuild.exe&quot; src/modules/FileLocksmith/FileLocksmithCLI/FileLocksmithCLI.vcxproj /p:Configuration=Release /p:Platform=x64\n\n构建原生组件（Release x64）\n&quot;C:\\\\Program Files\\\\Microsoft Visual Studio\\\\2022\\\\Professional\\\\MSBuild\\\\Current\\\\Bin\\\\MSBuild.exe&quot; src/modules/FileLocksmith/FileLocksmithLib/FileLocksmithLib.vcxproj /p:Configuration=Release /p:Platform=x64&quot;C:\\\\Program Files\\\\Microsoft Visual Studio\\\\2022\\\\Professional\\\\MSBuild\\\\Current\\\\Bin\\\\MSBuild.exe&quot; src/modules/FileLocksmith/FileLocksmithLibInterop/FileLocksmithLibInterop.vcxproj /p:Configuration=Release /p:Platform=x64\n\n构建右键菜单组件（Release x64）\n&quot;C:\\\\Program Files\\\\Microsoft Visual Studio\\\\2022\\\\Professional\\\\MSBuild\\\\Current\\\\Bin\\\\MSBuild.exe&quot; src/modules/FileLocksmith/FileLocksmithContextMenu/FileLocksmithContextMenu.vcxproj /p:Configuration=Release /p:Platform=x64&quot;C:\\\\Program Files\\\\Microsoft Visual Studio\\\\2022\\\\Professional\\\\MSBuild\\\\Current\\\\Bin\\\\MSBuild.exe&quot; src/modules/FileLocksmith/FileLocksmithExt/FileLocksmithExt.vcxproj /p:Configuration=Release /p:Platform=x64\n\nCLI 与原生项目（可选）\n\n使用 Visual Studio 2022 打开对应 .vcxproj，选择 x64 构建。\n\n便携包powershell -ExecutionPolicy Bypass -File tools\\\\FileLocksmithPortable\\\\pack.ps1 -Platform x64 -Configuration Release -Mode Portablepowershell -ExecutionPolicy Bypass -File tools\\\\FileLocksmithPortable\\\\pack.ps1 -Platform x64 -Configuration Release -Mode System\n\n便携版构建&#x2F;打包常见问题\n\n输出目录为空：pack.ps1 依赖 x64/Release/WinUI3Apps。请先构建 UI，再打包。\nSystem 模式找不到 WinUI3Apps.System：请先执行 build_and_pack.bat 或用相同参数构建 System 版本 UI。\n便携版点击关于&#x2F;设置闪退（MUI 资源缺失）：若输出目录缺少 FileLocksmithXAML、Assets 或语言目录（如 zh-CN），WinUI 资源加载会崩溃。pack.ps1 已改为复制 WinUI3Apps 下所有子目录，若仍异常请重新构建并打包。\nSystem dependency versions 启动失败：请确认系统已安装 Windows App SDK Runtime、VC++ 运行库与 WebView2 Runtime。\n\n其他文档\ntools/FileLocksmithPortable/README.md：便携版打包与使用说明\nsrc/common/Telemetry/README.md：Telemetry 采集说明（排查&#x2F;性能）\nsrc/common/CalculatorEngineCommon/README.md：exprtk 封装说明（共享库）\ndeps/spdlog/README.md：第三方日志依赖说明\n同目录下 *.Original.md 为上游&#x2F;历史说明备份（PowerToys 官方说明）\n\n作者与信息\n创建日期：2026-01-29\n制作者：亓翎_Re-TikaRa\n网站：https://re-tikara.fun\n\n许可本项目遵循 PowerToys 仓库的原始许可，即 MIT 许可，详见仓库根目录 LICENSE。\n免责声明本项目为开源研究与学习用途的软件分支，按“现状”提供，不对适用性、稳定性或特定用途做任何保证。使用本项目进行文件占用解除、进程终止、右键菜单注册&#x2F;卸载等操作可能影响系统或数据，请自行确认风险并对操作结果负责。\n","tags":["project"]}]